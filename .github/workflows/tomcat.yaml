on:
  workflow_dispatch:

jobs:
  install-tomcat:
    runs-on: [self-hosted]

    steps:
      - name: Show system info
        run: |
          hostname
          cat /etc/os-release

      - name: Install Java (required by Tomcat)
        run: |
          sudo dnf install -y java-17-openjdk

      - name: Download Tomcat
        run: |
          sudo mkdir -p /opt/tomcat
          sudo chmod 777 /opt/tomcat
          wget https://downloads.apache.org/tomcat/tomcat-10/v10.1.43/bin/apache-tomcat-10.1.43.tar.gz -P /opt/tomcat
    
          sudo tar xzf /opt/tomcat/apache-tomcat-10.1.43.tar.gz -C /opt/tomcat --strip-components=1

      - name: Setup permissions
        run: |
          sudo chmod 777 /opt/tomcat/bin/*.sh

      - name: Start Tomcat
        run: |
          /opt/tomcat/bin/startup.sh

      - name: Check Tomcat is running
        run: |
          ps aux | grep tomcat || echo "Tomcat not running"
